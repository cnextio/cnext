FROM python:3.9.7

ARG NODE_VERSION="16"

RUN curl -fsSL https://deb.nodesource.com/setup_${NODE_VERSION}.x | bash - \
    && apt-get install -y nodejs

RUN mkdir /app
WORKDIR /app

COPY . .

ENV PYTHONPATH=${PYTHONPATH}:${PWD}

WORKDIR /app/cnext_app
RUN npm install && npm run build
WORKDIR /app
RUN cp -rf ./cnext_app/out ./cnext_server/public

RUN pip3 install poetry
RUN poetry config virtualenvs.create false
RUN poetry --version
RUN poetry install --no-dev
RUN poetry build
RUN poetry publish -u bachbui  -p JupyterNext2022!